# 차량 계량대 시스템 재구축 TRD (기술 요구사항 문서)

**버전**: 1.0 | **상태**: DRAFT
**생성일**: 2026-01-26 10:00
**원본 PRD**: 차량 계량대 시스템 재구축 PRD (PRD-20260126-100000)

---

## 1. 기술 요약

본 문서는 차량 계량대 시스템 재구축 프로젝트의 기술 요구사항을 정의합니다. 기존 DOS 기반 레거시 시스템을 대체하여 클라우드 기반의 웹 관리 시스템과 크로스플랫폼 모바일 앱을 구축합니다. 현장의 기존 인디케이터(저울) 3대는 엣지 서버를 통해 RS-232 시리얼 통신으로 연동하며, ERP 시스템과 전광판도 연동합니다. AWS 클라우드 인프라를 활용하여 고가용성과 확장성을 확보합니다.

## 2. 기술 스택

### Frontend (웹)

- React 18.x - SPA 프레임워크
- TypeScript 5.x - 타입 안정성
- TailwindCSS 3.x - 유틸리티 CSS
- Zustand 4.x - 경량 상태관리
- Recharts 2.x - 대시보드 시각화
- Axios 1.x - HTTP 클라이언트
- Socket.io-client 4.x - 실시간 통신

**선정 이유**: React는 대규모 커뮤니티와 풍부한 생태계를 보유하고 있으며, TypeScript와의 조합으로 유지보수성이 향상됩니다. TailwindCSS는 빠른 UI 개발을 지원합니다.

### Frontend (모바일)

- Flutter 3.x - 크로스플랫폼 프레임워크
- Dart 3.x - 프로그래밍 언어
- Riverpod 2.x - 상태관리
- Firebase Cloud Messaging - 푸시 알림
- Hive 2.x - 오프라인 로컬 저장소

**선정 이유**: Flutter는 단일 코드베이스로 iOS/Android 앱을 동시에 개발할 수 있어 개발 효율성이 높습니다. FCM을 통해 안정적인 푸시 알림을 제공합니다.

### Backend

- FastAPI 0.100+ - Python 웹 프레임워크
- Python 3.11 - 프로그래밍 언어
- SQLAlchemy 2.x - ORM (비동기 지원)
- Celery 5.x - 비동기 작업 큐
- Socket.io 5.x - 실시간 통신

**선정 이유**: FastAPI는 고성능 비동기 처리와 자동 API 문서화를 지원합니다. 인디케이터 연동을 위한 pyserial 라이브러리와의 호환성도 우수합니다.

### Database & Cache

- PostgreSQL 15.x - 관계형 데이터베이스 (AWS RDS)
- Redis 7.x - 캐시 (AWS ElastiCache)
- AWS S3 - 파일 저장소 (전표 이미지 등)

**선정 이유**: PostgreSQL은 안정성과 성능이 검증된 RDBMS이며, AWS RDS의 Multi-AZ 구성으로 고가용성을 확보합니다.

### Edge Server (현장)

- Ubuntu 22.04 LTS - 운영체제
- Python 3.11 - 데이터 수집
- pyserial 3.x - RS-232 시리얼 통신
- SQLite - 오프라인 버퍼 로컬 DB

**선정 이유**: 경량 Linux 환경에서 안정적인 데이터 수집이 가능하며, 네트워크 장애 시 SQLite로 로컬 버퍼링을 지원합니다.

## 3. 시스템 아키텍처

### 3.1 아키텍처 개요

시스템은 클라우드(AWS)와 현장(On-Premise) 두 영역으로 구성됩니다. 클라우드에는 웹 앱, API 서버, 데이터베이스가 배치되며, 현장에는 엣지 서버가 인디케이터 및 전광판과 연동됩니다. 두 영역은 AWS Site-to-Site VPN으로 연결됩니다.

**아키텍처 스타일**: Layered Architecture with Edge Computing

### 3.2 아키텍처 레이어

#### Presentation Layer
사용자 인터페이스를 제공하는 계층

| 컴포넌트 | 타입 | 설명 |
|----------|------|------|
| Web Dashboard | SPA | React 기반 관리자용 웹 대시보드 |
| Mobile App | Native App | Flutter 기반 운전기사용 모바일 앱 |

#### API Layer
비즈니스 로직과 데이터 접근을 제공하는 계층

| 컴포넌트 | 타입 | 설명 |
|----------|------|------|
| API Gateway | Gateway | AWS API Gateway, 인증/라우팅 |
| App Server | Service | FastAPI 기반 애플리케이션 서버 |
| WebSocket Server | Service | Socket.io 기반 실시간 통신 서버 |

#### Data Layer
데이터 저장 및 캐싱 계층

| 컴포넌트 | 타입 | 설명 |
|----------|------|------|
| PostgreSQL | Database | AWS RDS, 메인 데이터 저장소 |
| Redis | Cache | AWS ElastiCache, 세션 및 캐싱 |
| S3 | Storage | 전표 이미지 및 리포트 파일 저장 |

#### Edge Layer
현장 데이터 수집 계층

| 컴포넌트 | 타입 | 설명 |
|----------|------|------|
| Edge Server | Service | 인디케이터 데이터 수집 및 전송 |
| Local Buffer | Storage | SQLite 기반 오프라인 버퍼 |

### 3.3 데이터 흐름

1. **계량 데이터 흐름**: 인디케이터 → Edge Server (RS-232) → API Server (HTTPS/VPN) → PostgreSQL → WebSocket → Web/Mobile
2. **대기열 흐름**: Mobile App → API Server → PostgreSQL → WebSocket → Web Dashboard / 전광판
3. **ERP 연동 흐름**: PostgreSQL → Celery Worker → ERP API (일 1회 배치)

## 4. 데이터베이스 설계

**데이터베이스 유형**: RDBMS
**권장 엔진**: PostgreSQL 15.x

### 4.1 엔티티 정의

#### vehicles
차량 정보를 저장하는 테이블

**속성**:
- id: UUID PRIMARY KEY
- plate_number: VARCHAR(20) NOT NULL UNIQUE - 차량번호
- vehicle_type: VARCHAR(50) - 차종
- empty_weight: DECIMAL(10,2) - 공차중량
- max_load: DECIMAL(10,2) - 최대적재량
- company_id: UUID FK - 소속회사
- is_active: BOOLEAN DEFAULT true - 활성 여부
- created_at: TIMESTAMP - 생성일시
- updated_at: TIMESTAMP - 수정일시

**기본 키**: id

**관계**:
- companies (N:1) - 소속회사
- drivers (1:N) - 담당 운전기사
- weighings (1:N) - 계량 이력

#### drivers
운전기사 정보를 저장하는 테이블

**속성**:
- id: UUID PRIMARY KEY
- name: VARCHAR(100) NOT NULL - 이름
- phone: VARCHAR(20) - 연락처
- company_id: UUID FK - 소속회사
- vehicle_id: UUID FK - 담당차량
- app_user_id: UUID FK - 앱 계정
- created_at: TIMESTAMP - 생성일시
- updated_at: TIMESTAMP - 수정일시

**기본 키**: id

**관계**:
- vehicles (N:1) - 담당 차량
- app_users (1:1) - 앱 계정
- weighings (1:N) - 계량 이력

#### weighings
계량 데이터를 저장하는 테이블

**속성**:
- id: UUID PRIMARY KEY
- vehicle_id: UUID FK - 차량
- driver_id: UUID FK - 운전기사
- scale_id: INTEGER NOT NULL - 계량대 ID
- gross_weight: DECIMAL(10,2) - 총중량
- tare_weight: DECIMAL(10,2) - 공차중량
- net_weight: DECIMAL(10,2) GENERATED - 순중량 (자동계산)
- weighing_time: TIMESTAMP NOT NULL - 계량일시
- receipt_number: VARCHAR(50) - 전표번호
- status: VARCHAR(20) - 상태
- created_at: TIMESTAMP - 생성일시

**기본 키**: id

**관계**:
- vehicles (N:1) - 차량
- drivers (N:1) - 운전기사

#### queue
대기열 정보를 저장하는 테이블

**속성**:
- id: UUID PRIMARY KEY
- vehicle_id: UUID FK - 차량
- driver_id: UUID FK - 운전기사
- queue_number: INTEGER NOT NULL - 대기순번
- status: VARCHAR(20) DEFAULT 'waiting' - 상태 (waiting/called/processing/completed/cancelled)
- registered_at: TIMESTAMP - 등록일시
- called_at: TIMESTAMP - 호출일시
- completed_at: TIMESTAMP - 완료일시

**기본 키**: id

**관계**:
- vehicles (N:1) - 차량
- drivers (N:1) - 운전기사

### 4.2 인덱싱 전략

- weighings 테이블: weighing_time, vehicle_id, driver_id에 복합 인덱스 생성 (조회 성능 최적화)
- queue 테이블: status, registered_at에 인덱스 생성 (대기열 조회 최적화)
- vehicles 테이블: plate_number에 UNIQUE 인덱스 (중복 방지 및 검색 최적화)

## 5. API 명세

**Base URL**: `/api/v1`
**인증 방식**: JWT (Bearer Token)

### 5.1 엔드포인트 목록

| 메서드 | 경로 | 설명 | 인증 |
|--------|------|------|------|
| GET | `/weighings` | 계량 목록 조회 | O |
| GET | `/weighings/{id}` | 계량 상세 조회 | O |
| POST | `/weighings` | 계량 데이터 등록 (Edge→Cloud) | O |
| PUT | `/weighings/{id}` | 계량 데이터 수정 | O |
| GET | `/weighings/statistics` | 통계 조회 | O |
| GET | `/weighings/export` | 엑셀 다운로드 | O |
| GET | `/queue` | 현재 대기열 조회 | O |
| POST | `/queue` | 대기열 등록 | O |
| PUT | `/queue/{id}/call` | 순번 호출 | O |
| DELETE | `/queue/{id}` | 대기열 취소 | O |
| GET | `/queue/my` | 내 순번 조회 (모바일) | O |
| GET | `/vehicles` | 차량 목록 조회 | O |
| POST | `/vehicles` | 차량 등록 | O |
| PUT | `/vehicles/{id}` | 차량 수정 | O |
| DELETE | `/vehicles/{id}` | 차량 삭제 | O |
| GET | `/drivers` | 운전기사 목록 조회 | O |
| POST | `/drivers` | 운전기사 등록 | O |
| PUT | `/drivers/{id}` | 운전기사 수정 | O |
| POST | `/auth/login` | 로그인 | X |
| POST | `/auth/refresh` | 토큰 갱신 | O |

### 5.2 에러 처리

표준 HTTP 상태 코드를 사용하며, 에러 응답은 다음 형식을 따릅니다:
```json
{
  "error": {
    "code": "ERR_INVALID_REQUEST",
    "message": "요청이 올바르지 않습니다.",
    "details": []
  }
}
```

## 6. 보안 요구사항

| 카테고리 | 요구사항 | 구현 방안 | 우선순위 |
|----------|----------|----------|----------|
| Authentication | 사용자 인증 | JWT + Refresh Token, OAuth 2.0 (ERP 연동) | HIGH |
| Authorization | 권한 관리 | Role-based Access Control (Admin, Operator, Driver) | HIGH |
| Data Protection | 전송 암호화 | TLS 1.2 이상 필수 | HIGH |
| Data Protection | 저장 암호화 | AES-256 (개인정보 필드) | HIGH |
| Data Protection | 로그 보안 | 민감정보 마스킹 | MEDIUM |
| Network | 네트워크 보안 | VPN (Edge-Cloud), IP Whitelist | HIGH |
| API Security | API 보안 | Rate Limiting, WAF (SQL Injection, XSS 방어) | HIGH |

## 7. 성능 요구사항

| 성능 지표 | 목표 값 | 측정 방법 |
|----------|---------|----------|
| API 응답 시간 | 200ms 이내 (95 percentile) | APM 모니터링 |
| 웹 페이지 로딩 | 3초 이내 | Lighthouse 측정 |
| 모바일 앱 로딩 | 3초 이내 | 앱 성능 모니터링 |
| 동시 접속자 | 50명 이상 | 부하 테스트 (k6, JMeter) |
| 데이터베이스 쿼리 | 100ms 이내 | Query Plan 분석 |
| WebSocket 지연 | 500ms 이내 | 실시간 모니터링 |

## 8. 인프라 요구사항

| 카테고리 | 사양 | 수량 | 용도 |
|----------|------|------|------|
| Compute | EC2 t3.medium | 2 | Web/API Server (Auto Scaling) |
| Database | RDS db.t3.medium | 1 | PostgreSQL 15 (Multi-AZ) |
| Cache | ElastiCache cache.t3.micro | 1 | Redis 7.x |
| Storage | S3 Standard | - | 전표 이미지, 리포트 파일 |
| CDN | CloudFront | - | 정적 파일 배포 |
| Network | VPC + Site-to-Site VPN | 1 | 현장-클라우드 연결 |
| Edge | Ubuntu Server | 1 | 현장 엣지 서버 |

## 9. 기술 리스크

| 리스크 | 위험도 | 영향 | 대응방안 |
|--------|--------|------|----------|
| B사 인디케이터 프로토콜 미확보 | MEDIUM | 연동 개발 지연 가능 | A사 프로토콜 기반 개발 후 B사 대응 |
| 현장 네트워크 불안정 | MEDIUM | 데이터 유실 가능 | Edge 서버 로컬 버퍼링 구현 |
| ERP 연동 테스트 환경 접근 지연 | MEDIUM | 연동 개발 지연 | Mock 서버로 선 개발 후 실환경 테스트 |
| iOS 앱 심사 지연 | LOW | 앱 출시 지연 | 사전 심사 가이드라인 준수 |
| 고령 사용자 앱 사용성 | LOW | 사용자 불만 | 큰 글씨, 간단한 UI, SMS 알림 병행 |

---

*본 TRD는 '차량 계량대 시스템 재구축 PRD' PRD를 기반으로 자동 생성되었습니다.*
