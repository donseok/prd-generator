{
  "id": "TRD-20260123-b6ad",
  "title": "**차량 계량 관리 시스템** - 기술 요구사항 문서 (TRD)",
  "executive_summary": "# 차량 계량 관리 시스템 기술 요약문\n\n본 시스템은 물류 및 자원 관리 현장의 차량 계량 업무를 디지털화하여 운영 효율성을 극대화하는 통합 플랫폼입니다.\n\n핵심 기술 결정사항으로 마이크로서비스 아키텍처와 이벤트 기반 패턴을 채택하였습니다. 이는 다중 계량대 환경에서 독립적인 서비스 확장과 장애 격리를 가능케 하며, 실시간 데이터 처리의 안정성을 확보합니다. 프론트엔드는 React 18과 TypeScript로 웹과 모바일(React Native)을 통합 개발하여 코드 재사용성을 높였고, 백엔드는 Python FastAPI로 고성능 비동기 처리를 구현합니다. 데이터 계층은 PostgreSQL로 트랜잭션 무결성을, Redis로 캐싱 및 실시간 세션 관리를 담당합니다.\n\n아키텍처의 주요 특징은 AWS 클라우드 네이티브 환경에서의 고가용성 구성입니다. 168개 기능과 42개 비기능 요구사항을 수용하는 확장 가능한 구조로, 계량 데이터 수집부터 통계 분석까지 전 과정을 자동화합니다.\n\n기술적 리스크로는 계량 장비와의 하드웨어 연동 호환성, 실시간 대용량 데이터 처리 시 병목 현상이 예상됩니다. 이에 대응하여 표준화된 장비 인터페이스 어댑터 패턴을 적용하고, 이벤트 큐 기반 비동기 처리와 수평 확장 전략으로 성능을 보장할 계획입니다.",
  "technology_stack": [
    {
      "category": "Frontend (Web)",
      "technologies": [
        "React 18",
        "TypeScript",
        "Tailwind CSS",
        "Recharts",
        "React Query",
        "Zustand"
      ],
      "rationale": "실시간 대시보드와 차트 시각화 요구사항에 React 18의 Concurrent Features가 적합합니다. 5초 간격 자동 갱신에 React Query의 캐싱/폴링 기능 활용, Recharts로 시간대별 계량 차트 구현, Zustand로 경량 상태 관리가 가능합니다. TypeScript로 계량 데이터 타입 안정성을 확보하고, Tailwind CSS로 반응형 위젯 UI를 빠르게 구축할 수 있습니다."
    },
    {
      "category": "Frontend (Mobile)",
      "technologies": [
        "React Native",
        "TypeScript",
        "React Navigation",
        "React Native Paper"
      ],
      "rationale": "웹과 모바일 간 코드 공유 및 개발 생산성을 위해 React Native를 선택합니다. 운전기사 이력 조회, 계량 현황 확인 등 모바일 요구사항을 iOS/Android 동시 지원하며, 웹 개발팀의 React 경험을 그대로 활용할 수 있습니다."
    },
    {
      "category": "Backend",
      "technologies": [
        "Python 3.11",
        "FastAPI",
        "SQLAlchemy 2.0",
        "Pydantic v2",
        "Celery",
        "Redis"
      ],
      "rationale": "FastAPI의 비동기 처리로 실시간 계량 데이터 수신 및 WebSocket 기반 현황 업데이트를 효율적으로 처리합니다. 인디케이터(계량기) 연동을 위한 시리얼 통신 또는 TCP/IP 프로토콜 처리에 Python이 유연하며, SQLAlchemy 2.0으로 복잡한 통계 쿼리(일/월별 집계, 회사별 현황)를 ORM으로 구현합니다. Celery로 통계 배치 처리와 과적 알림을 비동기 수행합니다."
    },
    {
      "category": "Database",
      "technologies": [
        "PostgreSQL 15",
        "Redis 7"
      ],
      "rationale": "PostgreSQL의 윈도우 함수와 집계 함수로 계량 통계(일평균, 월별 집계, 처리시간 계산)를 효율적으로 수행합니다. 파티셔닝으로 대용량 계량 이력 데이터를 관리하고, JSONB로 수정 이력을 유연하게 저장합니다. Redis는 실시간 계량대 상태 캐싱, 대기열 관리, 세션 저장에 활용됩니다. AWS RDS Multi-AZ로 고가용성 요구사항을 충족합니다."
    },
    {
      "category": "Infrastructure",
      "technologies": [
        "Docker",
        "AWS ECS Fargate",
        "AWS RDS",
        "AWS ElastiCache",
        "CloudFront",
        "ALB",
        "Site-to-Site VPN"
      ],
      "rationale": "Medium 확장성 요구에 ECS Fargate가 적합하며, Kubernetes 대비 운영 복잡도가 낮습니다. CloudFront로 정적 파일 배포, ALB로 로드 밸런싱, RDS Multi-AZ로 DB 고가용성을 확보합니다. Site-to-Site VPN으로 현장 계량기와 안전한 통신을 구성하고, Security Group 최소 권한 원칙을 적용합니다."
    },
    {
      "category": "DevOps & Monitoring",
      "technologies": [
        "GitHub Actions",
        "Terraform",
        "CloudWatch",
        "AWS X-Ray"
      ],
      "rationale": "GitHub Actions로 CI/CD 파이프라인 구축, Terraform으로 인프라 코드 관리를 수행합니다. CloudWatch로 계량 처리 시간(8.5분 SLA) 모니터링 및 알림을 설정하고, X-Ray로 API 성능 추적이 가능합니다."
    },
    {
      "category": "Security & Auth",
      "technologies": [
        "AWS Cognito",
        "AWS IAM",
        "AWS Secrets Manager"
      ],
      "rationale": "Cognito로 사용자 인증 및 역할 기반 권한 관리(데이터 수정 권한 제한)를 구현합니다. IAM으로 AWS 리소스 접근 제어, Secrets Manager로 DB 자격증명 및 API 키를 안전하게 관리합니다. Standard 보안 수준에 적합한 구성입니다."
    }
  ],
  "system_architecture": {
    "overview": "차량 계량 관리 시스템은 마이크로서비스 기반의 클라우드 네이티브 아키텍처로 설계되었습니다. 다중 계량대의 실시간 데이터 수집, 차량/운전기사 마스터 관리, 통계 분석을 위한 확장 가능한 구조를 제공하며, AWS 인프라를 활용하여 고가용성과 보안을 보장합니다.",
    "architecture_style": "Microservices with Event-Driven patterns",
    "layers": [
      {
        "name": "Presentation Layer",
        "description": "사용자 인터페이스를 담당하는 계층으로, 웹과 모바일 클라이언트를 통해 계량 데이터 조회, 마스터 관리, 실시간 현황 모니터링 기능을 제공합니다.",
        "components": [
          {
            "name": "Web Application",
            "type": "frontend",
            "description": "React 18 기반 SPA로 관리자 및 운영자용 대시보드 제공",
            "responsibilities": [
              "계량 데이터 조회 및 입력 UI",
              "실시간 현황 위젯 렌더링",
              "금일 통계 대시보드",
              "차량/운전기사/회사 마스터 관리 화면",
              "계량 통계 차트 시각화"
            ],
            "dependencies": [
              "API Gateway",
              "CloudFront CDN"
            ],
            "interfaces": [
              "REST API",
              "WebSocket"
            ]
          },
          {
            "name": "Mobile Application",
            "type": "frontend",
            "description": "React Native 기반 모바일 앱으로 현장 운전기사 및 계량원용",
            "responsibilities": [
              "계량 데이터 실시간 조회",
              "운전기사 본인 계량 이력 확인",
              "푸시 알림 수신 (초과 적재 경고 등)",
              "오프라인 모드 지원"
            ],
            "dependencies": [
              "API Gateway",
              "Push Notification Service"
            ],
            "interfaces": [
              "REST API",
              "WebSocket"
            ]
          }
        ]
      },
      {
        "name": "API Gateway Layer",
        "description": "모든 클라이언트 요청의 단일 진입점으로, 인증/인가, 라우팅, 속도 제한, 요청 로깅을 담당합니다.",
        "components": [
          {
            "name": "AWS ALB + API Gateway",
            "type": "gateway",
            "description": "Application Load Balancer와 연계된 API 게이트웨이",
            "responsibilities": [
              "요청 라우팅 및 로드밸런싱",
              "JWT 토큰 검증 (Cognito 연동)",
              "Rate Limiting",
              "요청/응답 로깅",
              "CORS 처리"
            ],
            "dependencies": [
              "AWS Cognito",
              "Backend Services"
            ],
            "interfaces": [
              "HTTPS",
              "WebSocket Secure"
            ]
          }
        ]
      },
      {
        "name": "Application Layer",
        "description": "비즈니스 로직을 처리하는 마이크로서비스들로 구성되며, 각 서비스는 독립적으로 배포 및 확장 가능합니다.",
        "components": [
          {
            "name": "Weighing Service",
            "type": "microservice",
            "description": "계량 데이터 기록 및 조회를 담당하는 핵심 서비스",
            "responsibilities": [
              "계량 데이터 CRUD",
              "복수 계량대 데이터 수집",
              "최대적재량 초과 검증 로직",
              "계량 이벤트 발행"
            ],
            "dependencies": [
              "PostgreSQL",
              "Redis",
              "Event Bus"
            ],
            "interfaces": [
              "REST API",
              "Event Publisher"
            ]
          },
          {
            "name": "Vehicle Service",
            "type": "microservice",
            "description": "차량 마스터 정보 관리 서비스",
            "responsibilities": [
              "차량 등록/수정/삭제/조회",
              "차종별 분류 관리",
              "최대적재량 정보 관리",
              "차량 상태 관리"
            ],
            "dependencies": [
              "PostgreSQL",
              "Redis Cache"
            ],
            "interfaces": [
              "REST API"
            ]
          },
          {
            "name": "Driver Service",
            "type": "microservice",
            "description": "운전기사 정보 관리 서비스",
            "responsibilities": [
              "운전기사 등록/수정/삭제/조회",
              "소속회사 연계 관리",
              "면허 정보 관리"
            ],
            "dependencies": [
              "PostgreSQL",
              "Company Service"
            ],
            "interfaces": [
              "REST API"
            ]
          },
          {
            "name": "Company Service",
            "type": "microservice",
            "description": "소속회사 관리 서비스",
            "responsibilities": [
              "회사 등록/수정/삭제/조회",
              "회사별 차량/운전기사 현황 집계"
            ],
            "dependencies": [
              "PostgreSQL"
            ],
            "interfaces": [
              "REST API"
            ]
          },
          {
            "name": "Statistics Service",
            "type": "microservice",
            "description": "계량 통계 및 분석 서비스",
            "responsibilities": [
              "금일 계량 통계 집계",
              "기간별 통계 요약 생성",
              "차량/운전기사/회사별 통계",
              "초과 적재 통계"
            ],
            "dependencies": [
              "PostgreSQL",
              "Redis",
              "Weighing Service"
            ],
            "interfaces": [
              "REST API"
            ]
          },
          {
            "name": "Real-time Service",
            "type": "microservice",
            "description": "실시간 현황 데이터 제공 서비스",
            "responsibilities": [
              "WebSocket 연결 관리",
              "실시간 계량 현황 브로드캐스트",
              "실시간 위젯 데이터 푸시"
            ],
            "dependencies": [
              "Redis Pub/Sub",
              "Event Bus"
            ],
            "interfaces": [
              "WebSocket",
              "Event Subscriber"
            ]
          },
          {
            "name": "Notification Service",
            "type": "microservice",
            "description": "알림 발송 서비스",
            "responsibilities": [
              "초과 적재 경고 알림",
              "푸시 알림 발송",
              "이메일/SMS 알림 (선택적)"
            ],
            "dependencies": [
              "AWS SNS",
              "Event Bus"
            ],
            "interfaces": [
              "Event Subscriber"
            ]
          }
        ]
      },
      {
        "name": "Integration Layer",
        "description": "외부 시스템 연동 및 비동기 처리를 담당하는 계층입니다.",
        "components": [
          {
            "name": "Scale Bridge Service",
            "type": "integration",
            "description": "물리적 계량대 장비와의 연동 서비스 (Site-to-Site VPN 통해 온프레미스 연결)",
            "responsibilities": [
              "계량대 프로토콜 변환",
              "계량 데이터 수신",
              "장비 상태 모니터링",
              "연결 재시도 로직"
            ],
            "dependencies": [
              "Site-to-Site VPN",
              "Weighing Service"
            ],
            "interfaces": [
              "TCP/IP",
              "Serial Protocol",
              "REST API"
            ]
          },
          {
            "name": "Event Bus (Redis Streams)",
            "type": "message-broker",
            "description": "서비스 간 이벤트 기반 통신을 위한 메시지 브로커",
            "responsibilities": [
              "이벤트 발행/구독",
              "메시지 영속성",
              "이벤트 재처리 지원"
            ],
            "dependencies": [
              "Redis"
            ],
            "interfaces": [
              "Redis Streams API"
            ]
          },
          {
            "name": "Background Worker (Celery)",
            "type": "worker",
            "description": "비동기 작업 처리를 위한 워커",
            "responsibilities": [
              "통계 배치 집계",
              "리포트 생성",
              "데이터 정합성 검증",
              "알림 발송 처리"
            ],
            "dependencies": [
              "Redis (Broker)",
              "PostgreSQL"
            ],
            "interfaces": [
              "Celery Task Queue"
            ]
          }
        ]
      },
      {
        "name": "Data Layer",
        "description": "데이터 저장 및 캐싱을 담당하는 계층으로, 고가용성과 성능을 보장합니다.",
        "components": [
          {
            "name": "PostgreSQL (AWS RDS)",
            "type": "database",
            "description": "주요 비즈니스 데이터 저장소",
            "responsibilities": [
              "계량 데이터 영구 저장",
              "마스터 데이터 관리 (차량, 운전기사, 회사)",
              "트랜잭션 보장",
              "데이터 무결성 유지"
            ],
            "dependencies": [],
            "interfaces": [
              "SQL",
              "SQLAlchemy ORM"
            ]
          },
          {
            "name": "Redis (AWS ElastiCache)",
            "type": "cache",
            "description": "캐싱 및 실시간 데이터 처리",
            "responsibilities": [
              "API 응답 캐싱",
              "세션 저장",
              "실시간 현황 데이터 저장",
              "Pub/Sub 메시징",
              "Celery 브로커"
            ],
            "dependencies": [],
            "interfaces": [
              "Redis Protocol"
            ]
          }
        ]
      },
      {
        "name": "Security Layer",
        "description": "인증, 인가, 보안 관련 기능을 담당하는 횡단 관심사 계층입니다.",
        "components": [
          {
            "name": "AWS Cognito",
            "type": "identity-provider",
            "description": "사용자 인증 및 토큰 관리",
            "responsibilities": [
              "사용자 등록/로그인",
              "JWT 토큰 발급",
              "MFA 지원",
              "소셜 로그인 (선택적)"
            ],
            "dependencies": [],
            "interfaces": [
              "OAuth 2.0",
              "OIDC"
            ]
          },
          {
            "name": "AWS IAM",
            "type": "authorization",
            "description": "AWS 리소스 접근 제어",
            "responsibilities": [
              "서비스 역할 기반 접근 제어",
              "최소 권한 원칙 적용"
            ],
            "dependencies": [],
            "interfaces": [
              "IAM Policy"
            ]
          },
          {
            "name": "AWS Secrets Manager",
            "type": "secrets",
            "description": "민감 정보 관리",
            "responsibilities": [
              "DB 자격 증명 관리",
              "API 키 관리",
              "자동 비밀번호 로테이션"
            ],
            "dependencies": [],
            "interfaces": [
              "AWS SDK"
            ]
          }
        ]
      },
      {
        "name": "Infrastructure Layer",
        "description": "컨테이너 오케스트레이션, 배포, 모니터링을 담당하는 인프라 계층입니다.",
        "components": [
          {
            "name": "AWS ECS Fargate",
            "type": "container-orchestration",
            "description": "서버리스 컨테이너 실행 환경",
            "responsibilities": [
              "컨테이너 배포 및 관리",
              "자동 스케일링",
              "서비스 디스커버리"
            ],
            "dependencies": [
              "Docker",
              "ECR"
            ],
            "interfaces": [
              "ECS API"
            ]
          },
          {
            "name": "CloudFront",
            "type": "cdn",
            "description": "정적 콘텐츠 배포 및 캐싱",
            "responsibilities": [
              "프론트엔드 정적 자산 배포",
              "글로벌 엣지 캐싱",
              "DDoS 방어"
            ],
            "dependencies": [
              "S3"
            ],
            "interfaces": [
              "HTTPS"
            ]
          },
          {
            "name": "Monitoring Stack",
            "type": "observability",
            "description": "모니터링 및 추적 시스템",
            "responsibilities": [
              "CloudWatch 로그/메트릭 수집",
              "X-Ray 분산 추적",
              "알람 설정 및 통보"
            ],
            "dependencies": [
              "All Services"
            ],
            "interfaces": [
              "CloudWatch API",
              "X-Ray SDK"
            ]
          },
          {
            "name": "CI/CD Pipeline",
            "type": "devops",
            "description": "GitHub Actions 기반 자동화 파이프라인",
            "responsibilities": [
              "자동 빌드/테스트",
              "Terraform 인프라 프로비저닝",
              "Blue-Green 배포"
            ],
            "dependencies": [
              "GitHub",
              "Terraform",
              "AWS"
            ],
            "interfaces": [
              "GitHub Actions API"
            ]
          }
        ]
      }
    ],
    "data_flow": "사용자 요청은 CloudFront/ALB를 통해 API Gateway로 전달되고, Cognito에서 JWT 토큰 검증 후 적절한 마이크로서비스로 라우팅됩니다. 계량대에서 수집된 데이터는 Site-to-Site VPN을 통해 Scale Bridge Service로 전송되고, Weighing Service에서 검증 후 PostgreSQL에 저장됩니다. 최대적재량 초과 시 이벤트가 발행되어 Notification Service가 알림을 발송합니다. Real-time Service는 Redis Pub/Sub을 통해 계량 이벤트를 수신하여 WebSocket으로 클라이언트에 실시간 현황을 푸시합니다. Statistics Service는 Celery 워커를 통해 주기적으로 통계를 집계하고 Redis에 캐싱하여 대시보드 위젯에 빠른 응답을 제공합니다.",
    "deployment_diagram": ""
  },
  "database_design": {
    "database_type": "RDBMS",
    "recommended_engine": "PostgreSQL",
    "entities": [],
    "indexing_strategy": "",
    "partitioning_strategy": ""
  },
  "api_specification": {
    "base_url": "/api/v1",
    "authentication_method": "JWT",
    "endpoints": [],
    "common_headers": {},
    "error_handling": ""
  },
  "security_requirements": [
    {
      "category": "NFR-Based",
      "requirement": "데이터 수정 권한 제한",
      "implementation": "오류 데이터 수정은 권한자에 한함",
      "priority": "HIGH"
    },
    {
      "category": "NFR-Based",
      "requirement": "최소 권한 원칙 보안그룹",
      "implementation": "보안그룹에 최소 권한 원칙 적용",
      "priority": "HIGH"
    },
    {
      "category": "NFR-Based",
      "requirement": "사용자 인증",
      "implementation": "웹/앱 로그인 인증 및 권한 관리",
      "priority": "HIGH"
    },
    {
      "category": "NFR-Based",
      "requirement": "데이터 암호화",
      "implementation": "개인정보 및 민감 데이터 암호화 저장",
      "priority": "HIGH"
    },
    {
      "category": "NFR-Based",
      "requirement": "OAuth 2.0 인증",
      "implementation": "ERP 연동 시 OAuth 2.0 Client Credentials Grant 방식의 인증 적용",
      "priority": "HIGH"
    },
    {
      "category": "NFR-Based",
      "requirement": "TLS 1.2 이상 암호화 통신",
      "implementation": "데이터 전송 시 TLS 1.2 이상의 암호화 프로토콜 필수 적용",
      "priority": "HIGH"
    },
    {
      "category": "Authentication",
      "requirement": "사용자 인증 체계 구축",
      "implementation": "JWT 기반 토큰 인증",
      "priority": "HIGH"
    },
    {
      "category": "Authorization",
      "requirement": "역할 기반 접근 제어(RBAC)",
      "implementation": "사용자 역할별 권한 관리",
      "priority": "HIGH"
    },
    {
      "category": "Data Protection",
      "requirement": "민감 데이터 암호화",
      "implementation": "AES-256 암호화 적용",
      "priority": "HIGH"
    }
  ],
  "performance_requirements": [
    {
      "metric": "앱 응답속도",
      "target_value": "모바일 앱 화면 로딩 3초 이내",
      "measurement_method": "성능 테스트 도구 활용",
      "related_component": null
    }
  ],
  "infrastructure_requirements": [
    {
      "category": "Compute",
      "specification": "Application Server (4 vCPU, 16GB RAM)",
      "quantity": "2",
      "purpose": "웹 애플리케이션 서버",
      "estimated_cost": null
    },
    {
      "category": "Database",
      "specification": "Managed Database (8 vCPU, 32GB RAM, 500GB SSD)",
      "quantity": "1 (Primary-Replica)",
      "purpose": "주 데이터베이스",
      "estimated_cost": null
    },
    {
      "category": "Storage",
      "specification": "Object Storage (S3/GCS)",
      "quantity": "500GB",
      "purpose": "파일 저장소",
      "estimated_cost": null
    },
    {
      "category": "Network",
      "specification": "Load Balancer + CDN",
      "quantity": "1",
      "purpose": "트래픽 분산 및 정적 콘텐츠 배포",
      "estimated_cost": null
    }
  ],
  "technical_risks": [
    {
      "description": "외부 시스템 연동 복잡성",
      "level": "MEDIUM",
      "impact": "연동 인터페이스 변경 시 추가 개발 필요",
      "mitigation": "사전 인터페이스 정의 및 Mock 서버 활용",
      "contingency": "연동 범위 축소 또는 단계별 구현"
    },
    {
      "description": "대용량 데이터 처리 성능",
      "level": "MEDIUM",
      "impact": "응답 시간 지연 및 시스템 과부하",
      "mitigation": "캐싱 전략 및 비동기 처리 적용",
      "contingency": "데이터 처리 범위 조정"
    },
    {
      "description": "보안 취약점 발생 가능성",
      "level": "HIGH",
      "impact": "데이터 유출 및 서비스 중단",
      "mitigation": "보안 코드 리뷰 및 취약점 스캔 정기 수행",
      "contingency": "보안 패치 즉시 적용 체계 구축"
    }
  ],
  "metadata": {
    "version": "1.0",
    "status": "DRAFT",
    "created_at": "2026-01-23T15:34:56.572088",
    "updated_at": null,
    "source_prd_id": "PRD-20260123-ea69",
    "source_prd_title": "**차량 계량 관리 시스템**"
  }
}