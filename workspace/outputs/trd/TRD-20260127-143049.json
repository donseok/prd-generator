{
  "id": "TRD-20260127-143049",
  "title": "부산 스마트 계량 시스템",
  "version": "1.0",
  "status": "draft",
  "based_on_prd": "PRD-20260127-142114",
  "created_at": "2026-01-27T14:30:49+09:00",
  "technology_stack": {
    "frontend_web": [
      {"category": "Framework", "technology": "React", "version": "18.x", "reason": "PRD 기술 제약 명시, 컴포넌트 기반 UI 개발"},
      {"category": "State Management", "technology": "Zustand", "version": "4.x", "reason": "경량 상태관리, 보일러플레이트 최소화"},
      {"category": "UI Library", "technology": "Ant Design", "version": "5.x", "reason": "엔터프라이즈 UI 컴포넌트, 테이블 편의 기능 내장"},
      {"category": "Chart", "technology": "Apache ECharts", "version": "5.x", "reason": "대시보드 차트, 실시간 시각화"},
      {"category": "Build Tool", "technology": "Vite", "version": "5.x", "reason": "빠른 빌드, HMR 지원"},
      {"category": "HTTP Client", "technology": "Axios", "version": "1.x", "reason": "REST API 호출, 인터셉터 토큰 관리"},
      {"category": "Language", "technology": "TypeScript", "version": "5.x", "reason": "타입 안정성, 유지보수성"}
    ],
    "frontend_mobile": [
      {"category": "Framework", "technology": "Flutter", "version": "3.x", "reason": "PRD 기술 제약 명시, 크로스플랫폼"},
      {"category": "State Management", "technology": "Riverpod", "version": "2.x", "reason": "Flutter 공식 권장 상태관리"},
      {"category": "HTTP Client", "technology": "Dio", "version": "5.x", "reason": "Flutter HTTP 클라이언트, 인터셉터"},
      {"category": "Push Notification", "technology": "Firebase Cloud Messaging", "version": "-", "reason": "iOS/Android 통합 푸시"},
      {"category": "Local Storage", "technology": "Hive", "version": "2.x", "reason": "경량 NoSQL, 오프라인 캐싱"},
      {"category": "Language", "technology": "Dart", "version": "3.x", "reason": "Flutter 공식 언어"}
    ],
    "backend": [
      {"category": "Language", "technology": "Java", "version": "17 LTS", "reason": "장기 지원, 엔터프라이즈 표준"},
      {"category": "Framework", "technology": "Spring Boot", "version": "3.2.x", "reason": "PRD 기술 제약 명시, 내장 WAS"},
      {"category": "ORM", "technology": "Spring Data JPA", "version": "3.2.x", "reason": "표준 ORM, QueryDSL 연동"},
      {"category": "Query", "technology": "QueryDSL", "version": "5.x", "reason": "타입 안전 동적 쿼리"},
      {"category": "Security", "technology": "Spring Security", "version": "6.x", "reason": "인증/인가, JWT"},
      {"category": "API Docs", "technology": "Springdoc OpenAPI", "version": "2.x", "reason": "Swagger UI 자동 생성"},
      {"category": "Messaging", "technology": "Apache Kafka", "version": "3.x", "reason": "비동기 이벤트 처리"}
    ],
    "desktop_cs": [
      {"category": "IDE", "technology": "Visual Studio 2022 Professional", "version": "17.x", "reason": "PRD 기술 제약 명시"},
      {"category": "Language", "technology": "C#", "version": "11", "reason": ".NET 생태계, 시리얼 통신"},
      {"category": "Framework", "technology": ".NET 8 WinForms", "version": "8.x", "reason": "Windows 데스크톱, RS-232C 지원"},
      {"category": "Serial", "technology": "System.IO.Ports", "version": "-", "reason": "RS-232C 인디게이터 연동"}
    ],
    "database": [
      {"category": "Primary DB", "technology": "PostgreSQL", "version": "16.x", "reason": "PRD 기술 제약 명시, ACID, JSON 지원"},
      {"category": "Cache", "technology": "Redis", "version": "7.x", "reason": "OTP 세션(TTL), 실시간 상태 캐싱"},
      {"category": "Connection Pool", "technology": "HikariCP", "version": "5.x", "reason": "Spring Boot 기본, 고성능"}
    ],
    "ai_lpr": [
      {"category": "LPR SDK", "technology": "외주 LPR 솔루션", "version": "-", "reason": "전용 하드웨어 + 소프트웨어"},
      {"category": "AI 검증", "technology": "TensorFlow / ONNX Runtime", "version": "-", "reason": "LPR 2차 검증"},
      {"category": "통신", "technology": "TCP/IP Socket", "version": "-", "reason": "LPR 실시간 통신"}
    ],
    "infrastructure": [
      {"category": "WAS", "technology": "Spring Boot Embedded Tomcat", "reason": "내장 서버, 배포 단순화"},
      {"category": "Web Server", "technology": "Nginx", "reason": "리버스 프록시, SSL 터미네이션"},
      {"category": "Container", "technology": "Docker", "reason": "컨테이너화, 환경 일관성"},
      {"category": "Orchestration", "technology": "Docker Compose", "reason": "멀티 컨테이너 관리"},
      {"category": "CI/CD", "technology": "Jenkins", "reason": "사내 CI/CD 파이프라인"},
      {"category": "Monitoring", "technology": "Prometheus + Grafana", "reason": "메트릭 수집 및 시각화"},
      {"category": "Log Management", "technology": "ELK Stack", "reason": "중앙 집중 로그 관리"},
      {"category": "Backup", "technology": "pg_dump + WAL", "reason": "일일 전체 + 실시간 증분 백업"}
    ]
  },
  "system_architecture": {
    "overview": "LPR 카메라 → AI 검증 서버 → 계량대 C/S → Spring Boot API → PostgreSQL/Redis, React Web + Flutter Mobile → Nginx → Spring Boot API",
    "components": [
      {"name": "LPR 카메라", "role": "차량 번호판 촬영 및 1차 인식", "technology": "LPR 전용 하드웨어"},
      {"name": "AI 검증 서버", "role": "LPR 인식 결과 2차 검증", "technology": "TensorFlow / ONNX Runtime"},
      {"name": "계량대 C/S 프로그램", "role": "현장 계량 처리, 장비 연동", "technology": "C# .NET 8 WinForms"},
      {"name": "Spring Boot API 서버", "role": "비즈니스 로직, REST API 제공", "technology": "Java 17, Spring Boot 3.2"},
      {"name": "Kafka Broker", "role": "계량 이벤트 비동기 처리", "technology": "Apache Kafka 3.x"},
      {"name": "React Web App", "role": "관리자용 웹 대시보드", "technology": "React 18, TypeScript"},
      {"name": "Flutter Mobile App", "role": "운전자/담당자용 모바일 APP", "technology": "Flutter 3.x, Dart"},
      {"name": "PostgreSQL", "role": "마스터/트랜잭션 데이터 저장", "technology": "PostgreSQL 16"},
      {"name": "Redis", "role": "OTP 세션, 실시간 상태 캐싱", "technology": "Redis 7.x"},
      {"name": "Nginx", "role": "리버스 프록시, SSL 터미네이션", "technology": "Nginx"}
    ],
    "communications": [
      {"from": "React Web", "to": "Spring Boot API", "protocol": "HTTPS (REST)", "description": "관리 웹 시스템 API 호출"},
      {"from": "Flutter App", "to": "Spring Boot API", "protocol": "HTTPS (REST)", "description": "모바일 APP API 호출"},
      {"from": "계량대 C/S", "to": "Spring Boot API", "protocol": "HTTPS (REST)", "description": "계량 실적 등록"},
      {"from": "계량대 C/S", "to": "인디게이터", "protocol": "RS-232C Serial", "description": "중량값 수신 (9600bps)"},
      {"from": "계량대 C/S", "to": "전광판", "protocol": "TCP/IP Socket", "description": "OTP 표시, 안내 메시지"},
      {"from": "계량대 C/S", "to": "자동차단기", "protocol": "TCP/IP Socket", "description": "차단기 개폐 제어"},
      {"from": "LPR 카메라", "to": "계량대 C/S", "protocol": "TCP/IP Socket", "description": "차량번호 인식 결과"},
      {"from": "레이더센서", "to": "계량대 C/S", "protocol": "Serial/TCP", "description": "차량 진입 감지"},
      {"from": "Spring Boot", "to": "Kafka", "protocol": "TCP", "description": "계량 이벤트 발행"},
      {"from": "Spring Boot", "to": "Redis", "protocol": "TCP (6379)", "description": "OTP 저장/조회"},
      {"from": "Spring Boot", "to": "PostgreSQL", "protocol": "TCP (5432)", "description": "데이터 CRUD"},
      {"from": "Spring Boot", "to": "카카오 알림톡", "protocol": "HTTPS", "description": "알림톡 발송"},
      {"from": "Spring Boot", "to": "FCM", "protocol": "HTTPS", "description": "모바일 Push 발송"}
    ]
  },
  "database_design": {
    "tables": [
      {
        "name": "company",
        "description": "운송사/거래처 정보",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "name", "type": "VARCHAR(100)", "nullable": false, "description": "업체명"},
          {"name": "business_no", "type": "VARCHAR(20)", "nullable": true, "description": "사업자번호"},
          {"name": "type", "type": "VARCHAR(20)", "nullable": false, "description": "업체 유형"},
          {"name": "contact", "type": "VARCHAR(20)", "nullable": true, "description": "연락처"},
          {"name": "address", "type": "VARCHAR(200)", "nullable": true, "description": "주소"},
          {"name": "is_active", "type": "BOOLEAN", "nullable": false, "default": "true", "description": "활성 상태"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"},
          {"name": "updated_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "수정일시"}
        ]
      },
      {
        "name": "vehicle",
        "description": "차량 정보",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "plate_number", "type": "VARCHAR(20)", "nullable": false, "description": "차량번호 (UNIQUE)"},
          {"name": "company_id", "type": "BIGINT", "nullable": false, "description": "FK → company.id"},
          {"name": "vehicle_type", "type": "VARCHAR(20)", "nullable": false, "description": "차량 유형"},
          {"name": "tonnage", "type": "DECIMAL(10,2)", "nullable": true, "description": "톤수"},
          {"name": "tare_weight", "type": "DECIMAL(10,2)", "nullable": true, "description": "공차 중량(kg)"},
          {"name": "is_active", "type": "BOOLEAN", "nullable": false, "default": "true", "description": "활성 상태"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"},
          {"name": "updated_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "수정일시"}
        ]
      },
      {
        "name": "driver",
        "description": "운전자 정보",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "name", "type": "VARCHAR(50)", "nullable": false, "description": "운전자명"},
          {"name": "phone", "type": "VARCHAR(20)", "nullable": false, "description": "전화번호 (UNIQUE)"},
          {"name": "company_id", "type": "BIGINT", "nullable": false, "description": "FK → company.id"},
          {"name": "login_id", "type": "VARCHAR(50)", "nullable": true, "description": "APP 로그인 ID"},
          {"name": "password_hash", "type": "VARCHAR(256)", "nullable": true, "description": "비밀번호 해시"},
          {"name": "role", "type": "VARCHAR(20)", "nullable": false, "default": "DRIVER", "description": "역할"},
          {"name": "fcm_token", "type": "VARCHAR(256)", "nullable": true, "description": "FCM 푸시 토큰"},
          {"name": "is_active", "type": "BOOLEAN", "nullable": false, "default": "true", "description": "활성 상태"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"},
          {"name": "updated_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "수정일시"}
        ]
      },
      {
        "name": "product",
        "description": "품목 정보",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "name", "type": "VARCHAR(100)", "nullable": false, "description": "품목명"},
          {"name": "category", "type": "VARCHAR(20)", "nullable": false, "description": "분류"},
          {"name": "unit", "type": "VARCHAR(10)", "nullable": false, "default": "kg", "description": "단위"},
          {"name": "is_active", "type": "BOOLEAN", "nullable": false, "default": "true", "description": "활성 상태"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"}
        ]
      },
      {
        "name": "dispatch",
        "description": "배차 정보",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "dispatch_no", "type": "VARCHAR(30)", "nullable": false, "description": "배차번호 (UNIQUE)"},
          {"name": "vehicle_id", "type": "BIGINT", "nullable": false, "description": "FK → vehicle.id"},
          {"name": "driver_id", "type": "BIGINT", "nullable": false, "description": "FK → driver.id"},
          {"name": "product_id", "type": "BIGINT", "nullable": false, "description": "FK → product.id"},
          {"name": "dispatch_type", "type": "VARCHAR(20)", "nullable": false, "description": "배차 유형"},
          {"name": "quantity", "type": "DECIMAL(10,2)", "nullable": true, "description": "예정 수량"},
          {"name": "status", "type": "VARCHAR(20)", "nullable": false, "default": "REGISTERED", "description": "상태"},
          {"name": "scheduled_date", "type": "DATE", "nullable": false, "description": "배차 예정일"},
          {"name": "notes", "type": "TEXT", "nullable": true, "description": "비고"},
          {"name": "created_by", "type": "BIGINT", "nullable": true, "description": "FK → user.id"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"},
          {"name": "updated_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "수정일시"}
        ]
      },
      {
        "name": "scale",
        "description": "계량대 정보",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "scale_name", "type": "VARCHAR(50)", "nullable": false, "description": "계량대명"},
          {"name": "location", "type": "VARCHAR(100)", "nullable": false, "description": "설치 위치"},
          {"name": "ip_address", "type": "VARCHAR(15)", "nullable": true, "description": "계량대 PC IP"},
          {"name": "port", "type": "INTEGER", "nullable": true, "description": "통신 포트"},
          {"name": "max_capacity", "type": "DECIMAL(10,2)", "nullable": true, "description": "최대 계량 용량(kg)"},
          {"name": "status", "type": "VARCHAR(20)", "nullable": false, "default": "ACTIVE", "description": "상태"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"}
        ]
      },
      {
        "name": "weighing",
        "description": "계량 실적",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "dispatch_id", "type": "BIGINT", "nullable": false, "description": "FK → dispatch.id"},
          {"name": "scale_id", "type": "BIGINT", "nullable": false, "description": "FK → scale.id"},
          {"name": "weighing_seq", "type": "INTEGER", "nullable": false, "default": "1", "description": "계량 차수"},
          {"name": "gross_weight", "type": "DECIMAL(10,2)", "nullable": true, "description": "총 중량(kg)"},
          {"name": "tare_weight", "type": "DECIMAL(10,2)", "nullable": true, "description": "공차 중량(kg)"},
          {"name": "net_weight", "type": "DECIMAL(10,2)", "nullable": true, "description": "순 중량(kg)"},
          {"name": "weighing_type", "type": "VARCHAR(20)", "nullable": false, "description": "계량 방식"},
          {"name": "lpr_plate_number", "type": "VARCHAR(20)", "nullable": true, "description": "LPR 인식 차량번호"},
          {"name": "lpr_confidence", "type": "DECIMAL(5,2)", "nullable": true, "description": "LPR 인식 신뢰도(%)"},
          {"name": "lpr_image_url", "type": "VARCHAR(500)", "nullable": true, "description": "LPR 촬영 이미지 경로"},
          {"name": "status", "type": "VARCHAR(20)", "nullable": false, "default": "WAITING", "description": "상태"},
          {"name": "measured_at", "type": "TIMESTAMP", "nullable": true, "description": "계량 완료 시각"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"},
          {"name": "updated_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "수정일시"}
        ]
      },
      {
        "name": "weighing_slip",
        "description": "전자 계량표",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "weighing_id", "type": "BIGINT", "nullable": false, "description": "FK → weighing.id"},
          {"name": "slip_no", "type": "VARCHAR(30)", "nullable": false, "description": "계량표 번호 (UNIQUE)"},
          {"name": "slip_data", "type": "JSONB", "nullable": false, "description": "계량표 상세 데이터"},
          {"name": "pdf_url", "type": "VARCHAR(500)", "nullable": true, "description": "PDF 파일 경로"},
          {"name": "shared_via", "type": "VARCHAR(20)", "nullable": true, "description": "공유 방법"},
          {"name": "shared_at", "type": "TIMESTAMP", "nullable": true, "description": "공유 시각"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "생성일시"}
        ]
      },
      {
        "name": "otp_log",
        "description": "OTP 로그",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "weighing_id", "type": "BIGINT", "nullable": true, "description": "FK → weighing.id"},
          {"name": "otp_code", "type": "VARCHAR(6)", "nullable": false, "description": "6자리 OTP"},
          {"name": "phone", "type": "VARCHAR(20)", "nullable": false, "description": "인증 대상 전화번호"},
          {"name": "verified", "type": "BOOLEAN", "nullable": false, "default": "false", "description": "인증 여부"},
          {"name": "expires_at", "type": "TIMESTAMP", "nullable": false, "description": "만료 시각"},
          {"name": "verified_at", "type": "TIMESTAMP", "nullable": true, "description": "인증 시각"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "생성일시"}
        ]
      },
      {
        "name": "gate_log",
        "description": "출문 기록",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "dispatch_id", "type": "BIGINT", "nullable": false, "description": "FK → dispatch.id"},
          {"name": "gate_type", "type": "VARCHAR(20)", "nullable": false, "description": "출문 유형"},
          {"name": "passed_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "통과 시각"},
          {"name": "guard_id", "type": "BIGINT", "nullable": true, "description": "FK → user.id"},
          {"name": "notes", "type": "TEXT", "nullable": true, "description": "비고"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"}
        ]
      },
      {
        "name": "user",
        "description": "시스템 사용자",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "login_id", "type": "VARCHAR(50)", "nullable": false, "description": "로그인 ID (UNIQUE)"},
          {"name": "password_hash", "type": "VARCHAR(256)", "nullable": false, "description": "비밀번호 해시"},
          {"name": "name", "type": "VARCHAR(50)", "nullable": false, "description": "사용자명"},
          {"name": "role", "type": "VARCHAR(20)", "nullable": false, "description": "역할"},
          {"name": "department", "type": "VARCHAR(50)", "nullable": true, "description": "부서"},
          {"name": "phone", "type": "VARCHAR(20)", "nullable": true, "description": "연락처"},
          {"name": "is_active", "type": "BOOLEAN", "nullable": false, "default": "true", "description": "활성 상태"},
          {"name": "last_login_at", "type": "TIMESTAMP", "nullable": true, "description": "마지막 로그인"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "등록일시"},
          {"name": "updated_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "수정일시"}
        ]
      },
      {
        "name": "notification_log",
        "description": "알림 기록",
        "columns": [
          {"name": "id", "type": "BIGSERIAL", "nullable": false, "default": "AUTO", "description": "Primary Key"},
          {"name": "target_type", "type": "VARCHAR(20)", "nullable": false, "description": "대상 유형"},
          {"name": "target_id", "type": "BIGINT", "nullable": false, "description": "대상 ID"},
          {"name": "channel", "type": "VARCHAR(20)", "nullable": false, "description": "채널"},
          {"name": "title", "type": "VARCHAR(200)", "nullable": false, "description": "알림 제목"},
          {"name": "body", "type": "TEXT", "nullable": false, "description": "알림 내용"},
          {"name": "status", "type": "VARCHAR(20)", "nullable": false, "default": "PENDING", "description": "상태"},
          {"name": "sent_at", "type": "TIMESTAMP", "nullable": true, "description": "발송 시각"},
          {"name": "created_at", "type": "TIMESTAMP", "nullable": false, "default": "now()", "description": "생성일시"}
        ]
      }
    ],
    "indexes": [
      {"table": "vehicle", "name": "idx_vehicle_plate", "columns": ["plate_number"], "type": "UNIQUE B-Tree", "purpose": "차량번호 검색 (LPR 매칭)"},
      {"table": "driver", "name": "idx_driver_phone", "columns": ["phone"], "type": "UNIQUE B-Tree", "purpose": "전화번호 기반 OTP 인증"},
      {"table": "dispatch", "name": "idx_dispatch_no", "columns": ["dispatch_no"], "type": "UNIQUE B-Tree", "purpose": "배차번호 검색"},
      {"table": "dispatch", "name": "idx_dispatch_date_status", "columns": ["scheduled_date", "status"], "type": "B-Tree", "purpose": "날짜별 배차 현황"},
      {"table": "dispatch", "name": "idx_dispatch_vehicle", "columns": ["vehicle_id"], "type": "B-Tree", "purpose": "차량별 배차 조회"},
      {"table": "dispatch", "name": "idx_dispatch_driver", "columns": ["driver_id"], "type": "B-Tree", "purpose": "운전자별 배차 조회"},
      {"table": "weighing", "name": "idx_weighing_dispatch", "columns": ["dispatch_id"], "type": "B-Tree", "purpose": "배차별 계량 조회"},
      {"table": "weighing", "name": "idx_weighing_date", "columns": ["measured_at"], "type": "B-Tree", "purpose": "날짜별 계량 실적"},
      {"table": "weighing", "name": "idx_weighing_status", "columns": ["status"], "type": "B-Tree", "purpose": "상태별 필터링"},
      {"table": "weighing", "name": "idx_weighing_lpr", "columns": ["lpr_plate_number"], "type": "B-Tree", "purpose": "LPR 번호 검색"},
      {"table": "weighing_slip", "name": "idx_slip_no", "columns": ["slip_no"], "type": "UNIQUE B-Tree", "purpose": "계량표 번호 검색"},
      {"table": "otp_log", "name": "idx_otp_code_expires", "columns": ["otp_code", "expires_at"], "type": "B-Tree", "purpose": "OTP 코드 검증"},
      {"table": "gate_log", "name": "idx_gate_dispatch", "columns": ["dispatch_id"], "type": "B-Tree", "purpose": "배차별 출문 조회"}
    ]
  },
  "api_specification": {
    "base_url": "/api/v1",
    "authentication": "Bearer Token (JWT)",
    "response_format": "JSON",
    "endpoints": {
      "auth": [
        {"method": "POST", "path": "/auth/login", "description": "웹 사용자 로그인", "auth": false},
        {"method": "POST", "path": "/auth/mobile/login", "description": "모바일 APP 로그인", "auth": false},
        {"method": "POST", "path": "/auth/mobile/verify", "description": "인증번호 확인", "auth": false},
        {"method": "POST", "path": "/auth/refresh", "description": "토큰 갱신", "auth": true},
        {"method": "POST", "path": "/auth/logout", "description": "로그아웃", "auth": true}
      ],
      "dispatch": [
        {"method": "GET", "path": "/dispatches", "description": "배차 목록 조회", "auth": true},
        {"method": "GET", "path": "/dispatches/{id}", "description": "배차 상세 조회", "auth": true},
        {"method": "POST", "path": "/dispatches", "description": "배차 등록", "auth": true},
        {"method": "PUT", "path": "/dispatches/{id}", "description": "배차 수정", "auth": true},
        {"method": "DELETE", "path": "/dispatches/{id}", "description": "배차 삭제", "auth": true},
        {"method": "GET", "path": "/dispatches/driver/{driverId}", "description": "운전자별 배차 조회", "auth": true},
        {"method": "PUT", "path": "/dispatches/{id}/status", "description": "배차 상태 변경", "auth": true}
      ],
      "weighing": [
        {"method": "GET", "path": "/weighings", "description": "계량 실적 목록 조회", "auth": true},
        {"method": "GET", "path": "/weighings/{id}", "description": "계량 상세 조회", "auth": true},
        {"method": "POST", "path": "/weighings", "description": "계량 등록", "auth": true},
        {"method": "PUT", "path": "/weighings/{id}", "description": "계량 수정", "auth": true},
        {"method": "POST", "path": "/weighings/{id}/reweigh", "description": "재계량 요청", "auth": true},
        {"method": "GET", "path": "/weighings/stats", "description": "계량 통계 조회", "auth": true},
        {"method": "GET", "path": "/weighings/realtime", "description": "실시간 계량 현황", "auth": true}
      ],
      "otp": [
        {"method": "POST", "path": "/otp/generate", "description": "OTP 생성", "auth": true},
        {"method": "POST", "path": "/otp/verify", "description": "OTP 검증", "auth": true}
      ],
      "slip": [
        {"method": "GET", "path": "/slips", "description": "계량표 목록 조회", "auth": true},
        {"method": "GET", "path": "/slips/{id}", "description": "계량표 상세 조회", "auth": true},
        {"method": "GET", "path": "/slips/{id}/pdf", "description": "계량표 PDF 다운로드", "auth": true},
        {"method": "POST", "path": "/slips/{id}/share", "description": "계량표 공유", "auth": true}
      ],
      "master_data": [
        {"method": "GET", "path": "/companies", "description": "업체 목록 조회", "auth": true},
        {"method": "POST", "path": "/companies", "description": "업체 등록", "auth": true},
        {"method": "PUT", "path": "/companies/{id}", "description": "업체 수정", "auth": true},
        {"method": "GET", "path": "/vehicles", "description": "차량 목록 조회", "auth": true},
        {"method": "POST", "path": "/vehicles", "description": "차량 등록", "auth": true},
        {"method": "PUT", "path": "/vehicles/{id}", "description": "차량 수정", "auth": true},
        {"method": "GET", "path": "/drivers", "description": "운전자 목록 조회", "auth": true},
        {"method": "POST", "path": "/drivers", "description": "운전자 등록", "auth": true},
        {"method": "PUT", "path": "/drivers/{id}", "description": "운전자 수정", "auth": true},
        {"method": "GET", "path": "/products", "description": "품목 목록 조회", "auth": true},
        {"method": "POST", "path": "/products", "description": "품목 등록", "auth": true},
        {"method": "GET", "path": "/scales", "description": "계량대 목록 조회", "auth": true}
      ],
      "gate": [
        {"method": "GET", "path": "/gates", "description": "출문 기록 조회", "auth": true},
        {"method": "POST", "path": "/gates", "description": "출문 기록 등록", "auth": true},
        {"method": "GET", "path": "/gates/check/{dispatchId}", "description": "배차별 출문 확인", "auth": true}
      ],
      "notification": [
        {"method": "POST", "path": "/notifications/push", "description": "Push 알림 발송", "auth": true},
        {"method": "POST", "path": "/notifications/kakao", "description": "카카오 알림톡 발송", "auth": true},
        {"method": "GET", "path": "/notifications", "description": "알림 이력 조회", "auth": true}
      ],
      "dashboard": [
        {"method": "GET", "path": "/dashboard/summary", "description": "대시보드 요약", "auth": true},
        {"method": "GET", "path": "/dashboard/weighing-chart", "description": "계량 추이 차트", "auth": true},
        {"method": "GET", "path": "/dashboard/dispatch-status", "description": "배차 현황", "auth": true}
      ]
    }
  },
  "security_requirements": {
    "authentication": {
      "web": "JWT (Access Token 30분 + Refresh Token 7일)",
      "mobile": "JWT + 인증번호(SMS) 2차 인증",
      "otp": "6자리 난수, Redis TTL 3분, 1회 사용",
      "rbac_roles": ["ADMIN", "OPERATOR", "GUARD", "VIEWER", "DRIVER", "MANAGER"]
    },
    "data_security": {
      "transport": "TLS 1.3",
      "storage": "AES-256 (개인정보)",
      "password": "bcrypt (cost factor 12)",
      "api_key": "장비 간 통신 인증",
      "masking": "전화번호/차량번호 로그 마스킹"
    },
    "policies": [
      "OWASP Top 10 대응",
      "SQL Injection 방지 (JPA Parameterized Query)",
      "XSS 방지 (React + CSP)",
      "CSRF 방지 (SameSite Cookie + CSRF Token)",
      "Rate Limiting (OTP: 1분 3회, API: 분당 100회)",
      "CORS 화이트리스트",
      "Security Headers",
      "접근 로그 감사 추적"
    ]
  },
  "performance_requirements": {
    "response_time": [
      {"target": "LPR 차량번호 인식", "value": "< 2초"},
      {"target": "AI 검증", "value": "< 1초"},
      {"target": "REST API (p50)", "value": "< 200ms"},
      {"target": "REST API (p95)", "value": "< 500ms"},
      {"target": "웹 페이지 로딩", "value": "< 3초"},
      {"target": "모바일 APP 응답", "value": "< 2초"},
      {"target": "OTP 생성/검증", "value": "< 100ms"}
    ],
    "throughput": [
      {"target": "동시 접속자 (웹)", "value": "50명"},
      {"target": "동시 접속자 (모바일)", "value": "100명"},
      {"target": "일일 계량 처리", "value": "500건 이상"},
      {"target": "TPS", "value": "50"}
    ],
    "optimization": [
      "DB Connection Pooling (HikariCP min 10 / max 30)",
      "Redis 캐싱 (기준정보 TTL 5분)",
      "Query Optimization (QueryDSL, N+1 방지)",
      "인덱스 최적화",
      "API 페이징 (기본 20건, 최대 100건)",
      "이미지 압축 (LPR 촬영)",
      "Gzip 압축 + 브라우저 캐싱",
      "Lazy Loading (차트 컴포넌트)"
    ]
  },
  "infrastructure_requirements": {
    "servers": [
      {"environment": "Development", "spec": "CPU 4Core, RAM 16GB, SSD 256GB"},
      {"environment": "Staging", "spec": "CPU 4Core, RAM 16GB, SSD 256GB"},
      {"environment": "Production - WEB/WAS", "spec": "CPU 8Core, RAM 32GB, SSD 512GB"},
      {"environment": "Production - DB", "spec": "CPU 8Core, RAM 32GB, SSD 1TB"},
      {"environment": "Production - File", "spec": "SSD 500GB (LPR 이미지)"},
      {"environment": "계량대 PC", "spec": "기존 장비, Windows 10"}
    ],
    "deployment": {
      "strategy": "Rolling Update (Docker Compose)",
      "pipeline": "Jenkins → Docker Build → Docker Compose Up",
      "rollback": "이전 Docker 이미지 태그로 재배포"
    },
    "monitoring": [
      {"target": "Application", "tool": "Prometheus + Grafana", "alert": "API p95 > 1초, 에러율 > 1%"},
      {"target": "Database", "tool": "pgAdmin + Prometheus Exporter", "alert": "커넥션 풀 > 80%, 슬로우 쿼리 > 3초"},
      {"target": "Server", "tool": "Grafana (Node Exporter)", "alert": "CPU > 80%, Memory > 85%, Disk > 90%"},
      {"target": "Log", "tool": "ELK Stack", "alert": "ERROR 로그, 계량 실패 이벤트"},
      {"target": "LPR", "tool": "자체 모니터링", "alert": "인식 실패율 > 10%, 통신 단절"},
      {"target": "Uptime", "tool": "Prometheus Blackbox", "alert": "서비스 다운 (1분 간격)"}
    ],
    "backup": [
      {"item": "DB 전체 백업", "method": "pg_dump", "schedule": "일 1회 02:00", "retention": "30일"},
      {"item": "DB 증분 백업", "method": "WAL 아카이빙", "schedule": "실시간", "retention": "7일"},
      {"item": "LPR 이미지", "method": "파일 복사", "schedule": "일 1회", "retention": "90일"},
      {"item": "애플리케이션 설정", "method": "Git", "schedule": "변경 시", "retention": "영구"}
    ]
  },
  "technical_risks": [
    {"id": "TR-001", "risk": "LPR 인식률 저하 (야간, 우천, 오염)", "impact": "HIGH", "probability": "MEDIUM", "mitigation": "AI 2차 검증 + 모바일 OTP 대체, 보조 조명 설치"},
    {"id": "TR-002", "risk": "계량대 네트워크 단절", "impact": "HIGH", "probability": "LOW", "mitigation": "오프라인 모드 (로컬 저장 후 재전송), 터치스크린 Failover"},
    {"id": "TR-003", "risk": "모바일 APP 배포 지연 (앱스토어 심사)", "impact": "MEDIUM", "probability": "MEDIUM", "mitigation": "사전 심사 일정 확보 (2주), 웹뷰 대체"},
    {"id": "TR-004", "risk": "RS-232C 장비 호환성", "impact": "MEDIUM", "probability": "LOW", "mitigation": "사전 프로토콜 분석, 기존 장비 재사용"},
    {"id": "TR-005", "risk": "카카오 알림톡 API 변경/장애", "impact": "LOW", "probability": "LOW", "mitigation": "SMS 대체 발송, Kafka DLQ 재시도"},
    {"id": "TR-006", "risk": "동시 계량 시 데이터 정합성", "impact": "HIGH", "probability": "LOW", "mitigation": "READ COMMITTED + 낙관적 잠금"},
    {"id": "TR-007", "risk": "AI 모델 정확도 미달", "impact": "MEDIUM", "probability": "MEDIUM", "mitigation": "현장 데이터 Fine-tuning, OTP 자동 전환"},
    {"id": "TR-008", "risk": "기존 시스템 데이터 마이그레이션", "impact": "MEDIUM", "probability": "MEDIUM", "mitigation": "단계별 마이그레이션, 병행 운영, 롤백 시나리오"}
  ]
}
