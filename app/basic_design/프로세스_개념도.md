# 프로세스 개념도 (Process Concept Diagram)
# PRD 자동 생성 시스템

**버전**: 1.0
**작성일**: 2026-01-22

---

## 1. 시스템 전체 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              사용자 (PM, BA)                                 │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Frontend (Next.js 14)                                │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐    │
│  │ Dashboard │ │  Upload   │ │ Processing│ │ PRD View  │ │  Review   │    │
│  │   Page    │ │   Page    │ │   Page    │ │   Page    │ │   Page    │    │
│  └───────────┘ └───────────┘ └───────────┘ └───────────┘ └───────────┘    │
│                              │                                              │
│                    ┌─────────┴─────────┐                                   │
│                    │   API Client      │                                   │
│                    │   (Axios + RQ)    │                                   │
│                    └───────────────────┘                                   │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │ HTTP/REST
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Backend (FastAPI)                                   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │                        API Layer (/api/v1)                          │    │
│  │  ┌────────┐ ┌───────────┐ ┌────────────┐ ┌──────┐ ┌────────┐      │    │
│  │  │ health │ │ documents │ │ processing │ │ prd  │ │ review │      │    │
│  │  └────────┘ └───────────┘ └────────────┘ └──────┘ └────────┘      │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                      │                                      │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │                       Service Layer                                 │    │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────────┐  │    │
│  │  │  ClaudeClient   │ │   FileStorage   │ │ PipelineOrchestrator│  │    │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────────┘  │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                      │                                      │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │                    4-Layer Processing Pipeline                      │    │
│  │  ┌──────────┐ ┌──────────────┐ ┌────────────┐ ┌────────────┐      │    │
│  │  │ Layer 1  │ │   Layer 2    │ │  Layer 3   │ │  Layer 4   │      │    │
│  │  │ Parsing  │→│Normalization │→│ Validation │→│ Generation │      │    │
│  │  └──────────┘ └──────────────┘ └────────────┘ └────────────┘      │    │
│  └────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
          │                                              │
          ▼                                              ▼
┌───────────────────┐                      ┌─────────────────────────┐
│   Claude Code     │                      │    File Storage         │
│      CLI          │                      │    (/data/)             │
│  (AI Processing)  │                      │  jobs/ prd/ uploads/    │
└───────────────────┘                      └─────────────────────────┘
```

---

## 2. 메인 처리 플로우

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PRD 생성 메인 플로우                                │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐
    │  시작    │
    └────┬─────┘
         │
         ▼
┌────────────────────┐
│  문서 업로드/입력   │ ←──── 사용자가 파일 업로드 또는 텍스트 입력
│  (FN-DOC-001/002)  │
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│  파이프라인 시작    │ ←──── ProcessingJob 생성 (status: PENDING)
│  (FN-PROC-001)     │
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│   Layer 1: 파싱    │ ←──── 문서 형식별 파서로 텍스트/구조 추출
│  (FN-PARSE-001)    │       status: PARSING
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│ Layer 2: 정규화    │ ←──── Claude AI로 요구사항 추출 및 정규화
│(FN-NORM-001~004)   │       status: NORMALIZING
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│  Layer 3: 검증     │ ←──── 품질 검증 및 검토 라우팅
│ (FN-VAL-001~002)   │       status: VALIDATING
└────────┬───────────┘
         │
         ▼
    ┌────────────┐
    │ 검토 필요? │
    └──────┬─────┘
           │
    ┌──────┴──────┐
    │ Yes         │ No
    ▼             ▼
┌─────────┐  ┌────────────────────┐
│PM 검토  │  │  Layer 4: 생성     │
│워크플로우│  │  (FN-GEN-001)      │
│(아래참조)│  │  status: GENERATING│
└────┬────┘  └─────────┬──────────┘
     │                 │
     └────────┬────────┘
              │
              ▼
     ┌────────────────┐
     │  PRD 저장      │ ←──── /data/prd/{prd_id}.json
     │  Job 완료      │       status: COMPLETED
     └────────┬───────┘
              │
              ▼
         ┌────────┐
         │  종료  │
         └────────┘
```

---

## 3. PM 검토 워크플로우

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            PM 검토 워크플로우                                 │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────┐
    │  검토 항목 발생    │ ←──── Layer 3에서 라우팅됨
    │  status: PM_REVIEW │
    └─────────┬─────────┘
              │
              ▼
    ┌───────────────────┐
    │ 검토 대기 목록    │ ←──── PM이 Review 페이지에서 확인
    │ 조회 (FN-REV-001) │
    └─────────┬─────────┘
              │
              ▼
    ┌───────────────────┐
    │ 각 항목 검토      │
    └─────────┬─────────┘
              │
              ▼
         ┌─────────┐
         │ 결정    │
         └────┬────┘
              │
    ┌─────────┼─────────┐
    │         │         │
    ▼         ▼         ▼
┌────────┐┌────────┐┌────────┐
│Approve ││Reject  ││Modify  │
│승인    ││거부    ││수정    │
└────┬───┘└────┬───┘└────┬───┘
     │         │         │
     │         │         ▼
     │         │    ┌─────────────┐
     │         │    │ 수정 내용   │
     │         │    │ 입력        │
     │         │    └──────┬──────┘
     │         │           │
     └─────────┴─────┬─────┘
                     │
                     ▼
           ┌─────────────────┐
           │ 결정 저장       │ ←──── ReviewItem.resolved = true
           │ (FN-REV-002)    │
           └────────┬────────┘
                    │
                    ▼
              ┌──────────┐
              │모든 항목 │
              │검토 완료?│
              └─────┬────┘
                    │
             ┌──────┴──────┐
             │ No          │ Yes
             ▼             ▼
      ┌───────────┐ ┌─────────────────┐
      │ 다음 항목 │ │ 검토 완료 처리  │
      │ 검토      │ │ (FN-REV-003)    │
      └───────────┘ └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ 결정 적용       │
                    │ - approve: 유지 │
                    │ - reject: 제외  │
                    │ - modify: 수정  │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ Layer 4 재개    │
                    │ PRD 생성        │
                    └─────────────────┘
```

---

## 4. Layer별 상세 처리 흐름

### 4.1 Layer 1: Parsing

```
┌─────────────────────────────────────────────────────────────────┐
│                     Layer 1: Parsing                             │
└─────────────────────────────────────────────────────────────────┘

    ┌────────────────┐
    │ InputDocument  │
    │ (파일/텍스트)   │
    └───────┬────────┘
            │
            ▼
    ┌────────────────┐
    │ 파일 유형 감지  │ ←──── InputType enum 결정
    └───────┬────────┘
            │
            ▼
    ┌────────────────┐
    │ ParserFactory  │ ←──── 적절한 파서 선택
    │ get_parser()   │
    └───────┬────────┘
            │
            ▼
    ┌───────┴───────┬───────────┬───────────┬───────────┐
    │               │           │           │           │
    ▼               ▼           ▼           ▼           ▼
┌────────┐   ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐
│ Text   │   │  Email   │ │  Excel   │ │   PPT    │ │  Image   │
│ Parser │   │  Parser  │ │  Parser  │ │  Parser  │ │  Parser  │
└────┬───┘   └────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘
     │            │            │            │            │
     └────────────┴────────────┴────────────┴────────────┘
                               │
                               ▼
                    ┌────────────────────┐
                    │   ParsedContent    │
                    │ - raw_text         │
                    │ - structured_data  │
                    │ - metadata         │
                    │ - sections         │
                    └────────────────────┘
```

### 4.2 Layer 2: Normalization

```
┌─────────────────────────────────────────────────────────────────┐
│                   Layer 2: Normalization                         │
└─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────┐
    │ List[ParsedContent] │
    └──────────┬──────────┘
               │
               ▼
    ┌─────────────────────┐
    │   요구사항 후보     │ ←──── Claude AI 호출
    │   추출 (Claude)     │       "요구사항을 추출해주세요"
    └──────────┬──────────┘
               │
               ▼
    ┌─────────────────────┐
    │ 각 후보에 대해 반복 │
    └──────────┬──────────┘
               │
    ┌──────────┴──────────┐
    │                     │
    ▼                     │
┌─────────────────┐       │
│ 유형 분류       │       │
│ FR/NFR/CONST    │       │
└────────┬────────┘       │
         │                │
         ▼                │
┌─────────────────┐       │
│ 우선순위 결정   │       │
│ HIGH/MED/LOW    │       │
└────────┬────────┘       │
         │                │
         ▼                │
┌─────────────────┐       │
│ User Story 생성 │ ←───── Claude AI 호출
│ (Claude)        │
└────────┬────────┘       │
         │                │
         ▼                │
┌─────────────────┐       │
│ AC 생성         │ ←───── Acceptance Criteria
│ (Claude)        │
└────────┬────────┘       │
         │                │
         ▼                │
┌─────────────────┐       │
│ 신뢰도 점수     │ ←───── 0.0 ~ 1.0
│ 계산 (Claude)   │
└────────┬────────┘       │
         │                │
         ▼                │
┌─────────────────────┐   │
│ NormalizedRequirement│   │
└──────────┬──────────┘   │
           │              │
           └──────────────┘
                │
                ▼
    ┌─────────────────────┐
    │ 관계 분석 (Claude)  │ ←──── depends_on, related_to, conflicts
    └──────────┬──────────┘
               │
               ▼
    ┌─────────────────────────────┐
    │ List[NormalizedRequirement] │
    └─────────────────────────────┘
```

### 4.3 Layer 3: Validation

```
┌─────────────────────────────────────────────────────────────────┐
│                     Layer 3: Validation                          │
└─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────┐
    │ List[NormalizedRequirement] │
    └──────────────┬──────────────┘
                   │
                   ▼
         ┌─────────────────┐
         │ 각 요구사항에   │
         │ 대해 검증       │
         └────────┬────────┘
                  │
    ┌─────────────┼─────────────┐
    │             │             │
    ▼             ▼             ▼
┌────────┐  ┌──────────┐  ┌──────────┐
│완전성  │  │일관성    │  │추적성    │
│검사    │  │검사      │  │검사      │
└────┬───┘  └────┬─────┘  └────┬─────┘
     │           │             │
     └───────────┴─────────────┘
                 │
                 ▼
        ┌────────────────┐
        │ ValidationResult│
        └───────┬────────┘
                │
                ▼
        ┌────────────────┐
        │  PM 검토 필요? │
        │ - score < 0.8  │
        │ - missing_info │
        │ - conflict     │
        └───────┬────────┘
                │
         ┌──────┴──────┐
         │ Yes         │ No
         ▼             ▼
    ┌──────────┐  ┌──────────────┐
    │ReviewItem│  │ Validated    │
    │ 생성     │  │ Requirements │
    └──────────┘  └──────────────┘
                │
                ▼
    ┌────────────────────────────────────────┐
    │ Output: (validated_reqs, review_items) │
    └────────────────────────────────────────┘
```

### 4.4 Layer 4: Generation

```
┌─────────────────────────────────────────────────────────────────┐
│                     Layer 4: Generation                          │
└─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────┐
    │ List[NormalizedRequirement] │
    │ (검증 완료)                  │
    └──────────────┬──────────────┘
                   │
                   ▼
         ┌─────────────────┐
         │ 카테고리 분류    │
         └────────┬────────┘
                  │
    ┌─────────────┼─────────────┐
    │             │             │
    ▼             ▼             ▼
┌────────┐  ┌──────────┐  ┌────────────┐
│   FR   │  │   NFR    │  │ Constraint │
│기능요구│  │비기능요구│  │ 제약조건   │
└────────┘  └──────────┘  └────────────┘
                  │
                  ▼
         ┌─────────────────┐
         │ Overview 생성   │ ←──── Claude AI 호출
         │ (Claude)        │       background, goals, scope
         └────────┬────────┘
                  │
                  ▼
         ┌─────────────────┐
         │ 마일스톤 생성   │ ←──── 우선순위/의존성 기반
         │ (Claude)        │
         └────────┬────────┘
                  │
                  ▼
         ┌─────────────────┐
         │ 미해결 사항     │ ←──── missing_info, 낮은 신뢰도
         │ 정리            │
         └────────┬────────┘
                  │
                  ▼
         ┌─────────────────┐
         │ PRDDocument     │
         │ 조립            │
         └────────┬────────┘
                  │
                  ▼
         ┌─────────────────┐
         │ 저장            │ ←──── /data/prd/{prd_id}.json
         └─────────────────┘
```

---

## 5. 데이터 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              데이터 흐름도                                    │
└─────────────────────────────────────────────────────────────────────────────┘

                    ┌──────────────────┐
                    │   입력 문서      │
                    │ (다양한 형식)    │
                    └────────┬─────────┘
                             │
                             ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│   InputDocument                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ id: "doc-abc123"                                                 │   │
│   │ input_type: "excel"                                              │   │
│   │ source_path: "/data/uploads/doc-abc123/data.xlsx"               │   │
│   │ content: ParsedContent { raw_text, structured_data, metadata }  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                           │
└────────────────────────────────┬─────────────────────────────────────────┘
                                 │ Layer 1: Parsing
                                 ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│   ParsedContent                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ raw_text: "전체 추출 텍스트..."                                  │   │
│   │ structured_data: { sheets: [{name: "Sheet1", data: [...]}] }    │   │
│   │ metadata: { filename, author, created_at, sheet_names }         │   │
│   │ sections: [{ title: "요구사항", content: "..." }]               │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                           │
└────────────────────────────────┬─────────────────────────────────────────┘
                                 │ Layer 2: Normalization
                                 ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│   NormalizedRequirement (여러 개)                                        │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ id: "REQ-001"                                                    │   │
│   │ type: "FR"                                                       │   │
│   │ title: "장바구니 수량 변경"                                      │   │
│   │ description: "사용자가 장바구니에서 수량을 변경할 수 있어야..."  │   │
│   │ user_story: "As a 쇼핑몰 회원, I want..."                        │   │
│   │ acceptance_criteria: ["수량 +/- 버튼", "직접 입력 가능"]        │   │
│   │ priority: "HIGH"                                                 │   │
│   │ confidence_score: 0.85                                           │   │
│   │ source_reference: "data.xlsx:Sheet1:A5"                         │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                           │
└────────────────────────────────┬─────────────────────────────────────────┘
                                 │ Layer 3: Validation
                                 ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│   Validated Requirements + ReviewItems (선택적)                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ validated: [NormalizedRequirement, ...]                          │   │
│   │ review_items: [                                                  │   │
│   │   { requirement_id: "REQ-003", issue_type: "LOW_CONFIDENCE" }   │   │
│   │ ]                                                                │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                           │
└────────────────────────────────┬─────────────────────────────────────────┘
                                 │ Layer 4: Generation
                                 ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│   PRDDocument                                                            │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ id: "prd-xyz789"                                                 │   │
│   │ title: "전자상거래 플랫폼 요구사항"                              │   │
│   │ overview: { background, goals, scope, target_users }            │   │
│   │ functional_requirements: [REQ-001, REQ-002, ...]                │   │
│   │ non_functional_requirements: [REQ-010, REQ-011, ...]            │   │
│   │ constraints: [REQ-020, ...]                                      │   │
│   │ milestones: [{ name: "M1: MVP", deliverables: [...] }]          │   │
│   │ unresolved_items: [{ type: "question", description: "..." }]    │   │
│   │ metadata: { version, status, confidence, created_at }           │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                           │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 상태 전이 다이어그램

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ProcessingJob 상태 전이                               │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────┐
                              │ PENDING │ ←──── Job 생성 직후
                              └────┬────┘
                                   │ 파이프라인 시작
                                   ▼
                              ┌─────────┐
                      ┌───────│ PARSING │ ←──── Layer 1 실행 중
                      │       └────┬────┘
                      │            │ 파싱 완료
                      │            ▼
                      │     ┌─────────────┐
                      │     │ NORMALIZING │ ←──── Layer 2 실행 중
                      │     └──────┬──────┘
                      │            │ 정규화 완료
                      │            ▼
                      │     ┌────────────┐
                      │     │ VALIDATING │ ←──── Layer 3 실행 중
                      │     └──────┬─────┘
                      │            │
                      │     ┌──────┴──────┐
                      │     │             │
                      │     ▼             ▼
                      │ ┌──────────┐  ┌────────────┐
                      │ │PM_REVIEW │  │ GENERATING │ ←──── Layer 4 실행 중
                      │ └────┬─────┘  └──────┬─────┘
                      │      │               │
                      │      │ 검토 완료     │
                      │      ▼               │
                      │ ┌────────────┐       │
                      │ │ GENERATING │       │
                      │ └──────┬─────┘       │
                      │        │             │
                      │        └──────┬──────┘
                      │               │ 생성 완료
                      │               ▼
                      │        ┌───────────┐
                      │        │ COMPLETED │ ←──── 최종 완료
                      │        └───────────┘
                      │
                      │ (어느 단계에서든 오류 발생 시)
                      │
                      └──────────────▶ ┌────────┐
                                       │ FAILED │
                                       └────────┘
```

---

## 7. 컴포넌트 상호작용

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         컴포넌트 상호작용 다이어그램                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐      ┌─────────────┐      ┌──────────────────┐
│   Client    │      │   FastAPI   │      │   Orchestrator   │
│ (Frontend)  │      │   (API)     │      │                  │
└──────┬──────┘      └──────┬──────┘      └────────┬─────────┘
       │                    │                      │
       │ POST /processing   │                      │
       │ /start             │                      │
       │───────────────────>│                      │
       │                    │                      │
       │                    │  create job          │
       │                    │─────────────────────>│
       │                    │                      │
       │ 202 Accepted       │                      │
       │<───────────────────│                      │
       │ {job_id}           │                      │
       │                    │                      │
       │                    │     ┌────────────────┴────────────────┐
       │                    │     │         Background Task         │
       │                    │     │                                 │
       │                    │     │  ┌──────────────────────────┐  │
       │                    │     │  │ Layer 1: Parsing         │  │
       │                    │     │  │   ParserFactory          │  │
       │                    │     │  │   → ParsedContent        │  │
       │                    │     │  └────────────┬─────────────┘  │
       │                    │     │               │                │
       │ GET /processing    │     │               ▼                │
       │ /status/{job_id}   │     │  ┌──────────────────────────┐  │
       │───────────────────>│     │  │ Layer 2: Normalization   │  │
       │                    │     │  │   Normalizer             │──┼──> Claude
       │ {status, progress} │     │  │   → NormalizedRequirement│<─┼──  AI
       │<───────────────────│     │  └────────────┬─────────────┘  │
       │                    │     │               │                │
       │    (polling)       │     │               ▼                │
       │                    │     │  ┌──────────────────────────┐  │
       │                    │     │  │ Layer 3: Validation      │  │
       │                    │     │  │   Validator              │──┼──> Claude
       │                    │     │  │   → ReviewItems?         │<─┼──  AI
       │                    │     │  └────────────┬─────────────┘  │
       │                    │     │               │                │
       │                    │     │       ┌───────┴───────┐        │
       │                    │     │       ▼               ▼        │
       │                    │     │  [PM Review]   ┌────────────┐  │
       │                    │     │       │        │ Layer 4    │  │
       │                    │     │       │        │ Generation │──┼──> Claude
       │                    │     │       │        │ → PRD      │<─┼──  AI
       │                    │     │       │        └──────┬─────┘  │
       │                    │     │       ▼               │        │
       │                    │     │  ┌────────────┐       │        │
       │                    │     │  │ FileStorage│<──────┘        │
       │                    │     │  │ save PRD   │                │
       │                    │     │  └────────────┘                │
       │                    │     │                                 │
       │                    │     └─────────────────────────────────┘
       │                    │                      │
       │ GET /prd/{prd_id}  │                      │
       │───────────────────>│                      │
       │                    │  get PRD             │
       │                    │─────────────────────>│
       │                    │                      │
       │ {PRDDocument}      │                      │
       │<───────────────────│                      │
       │                    │                      │
```
